# Copyright (C) 2022 Anthony Harrison
# SPDX-License-Identifier: GPL-3.0-or-later

import os

import xmlschema

from cve_bin_tool.log import LOGGER


def _validate_xml(filename, xsd_file):

    # Root folder where schemas are present
    root = os.path.dirname(os.path.abspath(__file__))
    schemas_dir = os.path.join(root, "schemas")
    the_schema = xmlschema.XMLSchema(os.path.join(schemas_dir, xsd_file))

    LOGGER.debug(f"Validate {filename} against {the_schema}")
    try:
        result = the_schema.validate(filename)
    except Exception as e:
        LOGGER.debug(f"Failed to validate {filename} against {xsd_file}. Exception {e}")
        result = "Fail"
    return result is None


def validate_spdx(filename):
    SPDX_SCHEMA = "spdx.xsd"
    return _validate_xml(filename, SPDX_SCHEMA)


def validate_cyclonedx(filename):
    CYCLONEDX_SCHEMA = "cyclonedx_gen.xsd"
    return _validate_xml(filename, CYCLONEDX_SCHEMA)


def validate_swid(filename):
    SWID_SCHEMA = "swid_gen.xsd"
    return _validate_xml(filename, SWID_SCHEMA)


def validate_pom(filename):
    POM_SCHEMA = "pom.xsd"
    return _validate_xml(filename, POM_SCHEMA)
